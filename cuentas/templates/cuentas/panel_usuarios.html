{% extends 'base.html' %}
{% load static %}

{% block title %}Panel de Administraci√≥n de Usuarios{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cuentas/admin.css' %}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <!-- Header del Panel -->
    <div class="admin-header dark-bg">
        <h1>üë• Panel de Administraci√≥n de Usuarios</h1>
        <p>Gestiona todos los usuarios del sistema desde aqu√≠</p>
    </div>

    <!-- Estad√≠sticas -->
    <div class="admin-stats">
        <div class="stat-card light-bg">
            <div class="stat-number">{{ total_usuarios }}</div>
            <div class="stat-label">Total Usuarios</div>
        </div>
        <div class="stat-card light-bg">
            <div class="stat-number">{{ usuarios|length }}</div>
            <div class="stat-label">En esta p√°gina</div>
        </div>
        <div class="stat-card light-bg">
            <div class="stat-number">{{ usuarios|length }}</div>
            <div class="stat-label">Usuarios Activos</div>
        </div>
    </div>

    <!-- Acciones Principales -->
    <div class="admin-actions">
        <a href="{% url 'cuentas:crear_usuario' %}" class="btn-admin btn-success-admin">
            ‚ûï Crear Nuevo Usuario
        </a>
        <a href="{% url 'cuentas:dashboard' %}" class="btn-admin btn-primary-admin">
            üè† Volver al Dashboard
        </a>
    </div>

    <!-- B√∫squeda -->
    <div class="search-container light-bg">
        <form method="get" class="search-form">
            <input type="text" name="q" class="search-input" 
                   placeholder="Buscar por nombre, apellido o email..." 
                   value="{{ query }}">
            <button type="submit" class="btn-admin btn-primary-admin">
                üîç Buscar
            </button>
            {% if query %}
                <a href="/panel_usuarios/" class="btn-admin btn-warning-admin">
                    ‚ùå Limpiar
                </a>
            {% endif %}
        </form>
    </div>

    <!-- Tabla de Usuarios -->
    <div class="users-table-container light-bg">
        {% if usuarios %}
            <table class="users-table">
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Email</th>
                        <th>Estado</th>
                        <th>Fecha Registro</th>
                        <th>√öltimo Acceso</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for usuario in usuarios %}
                        <tr>
                            <td>
                                <div class="user-info">
                                    <div class="user-avatar">
                                        {{ usuario.first_name|first|upper }}{{ usuario.last_name|first|upper }}
                                    </div>
                                    <div class="user-details">
                                        <h4>{{ usuario.get_full_name }}</h4>
                                        <p>@{{ usuario.username }}</p>
                                    </div>
                                </div>
                            </td>
                            <td>{{ usuario.email }}</td>
                            <td>
                                {% if usuario.is_active %}
                                    <span class="status-badge status-active">Activo</span>
                                {% else %}
                                    <span class="status-badge status-inactive">Inactivo</span>
                                {% endif %}
                                {% if usuario.is_staff %}
                                    <span class="status-badge status-staff">Staff</span>
                                {% endif %}
                            </td>
                            <td>{{ usuario.fecha_registro|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if usuario.last_login %}
                                    {{ usuario.last_login|date:"d/m/Y H:i" }}
                                {% else %}
                                    <span style="color: #6c757d;">Nunca</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="{% url 'cuentas:editar_usuario' usuario.id %}" 
                                       class="btn-action btn-edit" title="Editar Usuario">
                                        ‚úèÔ∏è
                                    </a>
                                    <a href="{% url 'cuentas:cambiar_contrase√±a' usuario.id %}" 
                                       class="btn-action btn-password" title="Cambiar Contrase√±a">
                                        üîí
                                    </a>
                                    <a href="{% url 'cuentas:eliminar_usuario' usuario.id %}" 
                                       class="btn-action btn-delete" title="Eliminar Usuario">
                                        üóëÔ∏è
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Paginaci√≥n -->
            {% if usuarios.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if usuarios.has_previous %}
                            <a href="?page=1{% if query %}&q={{ query }}{% endif %}">¬´ Primera</a>
                            <a href="?page={{ usuarios.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">‚Äπ Anterior</a>
                        {% endif %}

                        {% for num in usuarios.paginator.page_range %}
                            {% if usuarios.number == num %}
                                <span class="current">{{ num }}</span>
                            {% elif num > usuarios.number|add:'-3' and num < usuarios.number|add:'3' %}
                                <a href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}">{{ num }}</a>
                            {% endif %}
                        {% endfor %}

                        {% if usuarios.has_next %}
                            <a href="?page={{ usuarios.next_page_number }}{% if query %}&q={{ query }}{% endif %}">Siguiente ‚Ä∫</a>
                            <a href="?page={{ usuarios.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}">√öltima ¬ª</a>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% else %}
            <div style="text-align: center; padding: 60px; color: #6c757d;">
                <h3>No se encontraron usuarios</h3>
                <p>{% if query %}No hay usuarios que coincidan con tu b√∫squeda.{% else %}A√∫n no hay usuarios registrados.{% endif %}</p>
                {% if not query %}
                    <a href="{% url 'cuentas:crear_usuario' %}" class="btn-admin btn-success-admin" style="margin-top: 20px;">
                        ‚ûï Crear Primer Usuario
                    </a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

